import AnswerGeneratorAndValidator as AG
import EmbeddingHandler as EH

if __name__ == "__main__":
    qa_model_path = "models\\mdeberta-v3-base-squad2"       # Путь к модели для вопросов и ответов
    text_model_path = "models\\rugpt3small_based_on_gpt2"  # Путь к модели для генерации текста
    embedding_model_path = "models\\paraphrase-multilingual-MiniLM-L12-v2"  # Путь к модели для создания эмбеддингов

    # Инициализация классов
    assistant = AG.AnswerGeneratorAndValidator(qa_model_path, text_model_path)
    embedding_handler = EH.EmbeddingHandler(embedding_model_path)

    # База знаний (контексты)
    knowledge_base = [
    "Мармеладки появились в XIX веке. Они впервые производились из фруктового сока и сахара, а позже начали добавлять желатин.",
    "Мармеладки популярны благодаря своей текстуре и разнообразным вкусам, включая цитрусовые, ягодные и тропические.",
    
    "Шоколад был изобретен в Центральной Америке. Ацтеки считали его напитком богов и использовали какао-бобы как валюту.",
    "Первый твёрдый шоколад был произведён в 1847 году британской компанией Fry and Sons.",
    
    "Кофе является одним из самых популярных напитков в мире. Легенда гласит, что его открыли эфиопские пастухи в IX веке.",
    "Первое упоминание о кофейнях относится к XV веку, когда они начали появляться на Ближнем Востоке.",
    
    "Чай впервые начали пить в Китае около 5000 лет назад. Он считался лекарственным напитком.",
    "Зелёный чай — самый древний вид чая, его традиционно пьют в Японии и Китае.",
    
    "Первую газированную воду изобрели в Англии в 1767 году. Её производство стало популярным благодаря Джозефу Пристли.",
    "Газированные напитки начали массово производить в XIX веке с добавлением сиропов и ароматизаторов.",
    
    "Хлеб является одним из древнейших продуктов питания, впервые приготовленный более 10,000 лет назад.",
    "Закваска, которая делает хлеб пышным, была изобретена в Древнем Египте примерно 4000 лет назад.",
    
    "Пицца появилась в Неаполе, Италия, в конце XVIII века. Изначально это было блюдо бедняков.",
    "Первая пиццерия открылась в Неаполе в 1830 году и существует до сих пор.",
    
    "Сахарное производство началось в Индии более 2000 лет назад. Индийцы первыми научились кристаллизовать сахар.",
    "В средние века сахар считался редким и дорогим продуктом, доступным только богатым людям.",
    
    "Мороженое изобрели в Китае около 2000 лет назад, используя смесь снега и фруктовых соков.",
    "Итальянцы популяризировали мороженое в Европе, создав первые современные рецепты в XVI веке."
    ]


    # Вопрос
    questions = [
    # Вопросы о мармеладках
    "В каком веке появились мармеладки?",
    "Из чего изначально производили мармеладки?",
    "Какие вкусы мармеладок самые популярные?",

    # Вопросы о шоколаде
    "Где был изобретён шоколад?",
    "Как ацтеки использовали какао-бобы?",
    "Когда был произведён первый твёрдый шоколад?",

    # Вопросы о кофе
    "В какой стране, согласно легенде, впервые был открыт кофе?",
    "Когда начали появляться первые кофейни?",
    "Почему кофе называют одним из самых популярных напитков в мире?",

    # Вопросы о чае
    "Где и когда начали пить чай впервые?",
    "Какой вид чая считается самым древним?",
    "В каких странах традиционно пьют зелёный чай?",

    # Вопросы о газированной воде
    "Кто изобрёл первую газированную воду?",
    "В каком веке газированные напитки стали массово производиться?",
    "Какие ингредиенты добавляют в газированные напитки для улучшения вкуса?",

    # Вопросы о хлебе
    "Когда впервые начали готовить хлеб?",
    "Где была изобретена закваска для хлеба?",
    "Почему хлеб считается одним из самых древних продуктов питания?",

    # Вопросы о пицце
    "Где и когда появилась пицца?",
    "Какое блюдо считалось прообразом современной пиццы?",
    "Когда открылась первая пиццерия?",

    # Вопросы о сахаре
    "В какой стране начали производить сахар?",
    "Почему сахар считался редким продуктом в средние века?",
    "Как изменилось потребление сахара со временем?",

    # Вопросы о мороженом
    "Где изобрели мороженое?",
    "Какие ингредиенты использовали для первого мороженого?",
    "Когда итальянцы популяризировали мороженое в Европе?"
    ]
    # Вопрос
    question = questions[-2]
    print(f"Вопрос:\n{question}")
    print("-------------------------")
    # Поиск наиболее релевантного контекста
    relevant_context = embedding_handler.find_most_relevant_context(question, knowledge_base)
    print(f"Релевантный контекст:\n{relevant_context}")
    # Генерация 
    print("-------------------------")
    answer = assistant.generate_answer(relevant_context, question)
    print(f"Конечный ответ:\n{answer}")

